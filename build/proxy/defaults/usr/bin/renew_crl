#!/bin/sh


PATH_CA="/mnt/cluster/certificates"
CA_CONF="${PATH_CA}/mtls/mtls.cnf"

openssl ca -config $CA_CONF -gencrl -out ${PATH_CA}/mtls/crl.pem

if pidof haproxy > /dev/null
then
    echo -e 'commit ssl crl-file ${PATH_CA}/mtls/crl.pem' | socat stdio tcp4-connect:127.0.0.1:8404
    reload
fi
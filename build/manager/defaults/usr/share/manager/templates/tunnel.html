<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Access</title>

    <!-- Xterm.js for terminal emulation -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>

    <link rel="stylesheet" href="/manager/static/css/tunnel.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content" id="header-content">
                <h1>
                    <img src="/manager/static/img/remote-session.svg" alt="" width="32" height="32"
                        style="vertical-align: top;">
                    Migasfree Remote Access Console
                </h1>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar - Agent List -->
            <aside class="sidebar" id="sidebar">
                <div class="search-box">
                    <input type="text" id="search-agents" placeholder="ðŸ” Search agents..." />
                    <button class="btn-refresh" id="refresh-agents" title="Refresh">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z" />
                            <path
                                d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z" />
                        </svg>
                    </button>
                </div>


            </aside>

            <!-- Main Panel - Terminal/VNC/RDP -->
            <main class="main-panel">

                <div class="agents-list" id="agents-list">
                    <div class="loading">Loading agents...</div>
                </div>

                <div class="connection-panel hidden" id="connection-panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span class="agent-name" id="current-agent-name">Agent</span>
                            <span class="service-badge" id="current-service">SSH</span>
                        </div>
                        <div class="panel-actions">
                            <button class="btn-action" id="btn-disconnect" title="Disconnect">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path
                                        d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                                </svg>
                            </button>
                            <button class="btn-action" id="btn-fullscreen" title="F11 - Fullscreen">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path
                                        d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Terminal Container -->
                    <div class="terminal-container" id="terminal-container">
                        <div id="terminal"></div>
                    </div>

                    <!-- VNC/RDP Container (future) -->
                    <div class="vnc-container hidden" id="vnc-container">
                        <canvas id="vnc-canvas"></canvas>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Agent Details Modal -->
    <div class="modal hidden" id="agent-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Connect to Agent</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="agent-info" id="agent-info">
                    <!-- Agent details will be inserted here -->
                </div>
                <div class="service-selector">
                    <label>Select Service:</label>
                    <select id="service-select" class="service-select">
                        <!-- Options populated dynamically -->
                    </select>
                </div>

                <!-- SSH Username Input -->
                <div class="username-input" id="username-input">
                    <input type="text" id="ssh-username" placeholder="Enter username (e.g., root, ubuntu, admin)"
                        value="root" />
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Cancel</button>
                <button class="btn btn-primary" id="modal-connect">Connect</button>
            </div>
        </div>
    </div>

    <script type="module">
        import RFB from '/manager/static/novnc/core/rfb.js';
        window.RFB = RFB;
        console.log("noliloaded locally");
    </script>
    <script src="/manager/static/js/tunnel.js"></script>
</body>

</html>